<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>POS Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin:0; font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #4f46e5, #a78bfa); height:100vh; display:flex; justify-content:center; align-items:center;">

  <div style="
      background-color:white;
      width: 90%;
      max-width: 400px;
      border-radius: 25px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      padding: 40px 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: transform 0.3s ease;
    " id="loginCard">

    <h1 style="font-size: 28px; font-weight: 700; color:#4f46e5; margin-bottom:15px;">MartinezPOS</h1>
    <p style="font-size:14px; color:#6b7280; margin-bottom:30px;">Sign in to your account</p>

    <form id="loginForm" style="width:100%; display:flex; flex-direction:column; gap:20px;">

      <div style="position:relative;">
        <input id="username" placeholder="Username" required
          style="width:100%; padding:15px 15px 15px 45px; border-radius:15px; border:1px solid #d1d5db; font-size:16px; outline:none; box-sizing:border-box;">
        <span style="position:absolute; left:15px; top:50%; transform:translateY(-50%); color:#9ca3af;">ðŸ‘¤</span>
      </div>

      <div style="position:relative;">
        <input id="password" type="password" placeholder="Password" required
          style="width:100%; padding:15px 15px 15px 45px; border-radius:15px; border:1px solid #d1d5db; font-size:16px; outline:none; box-sizing:border-box;">
        <span style="position:absolute; left:15px; top:50%; transform:translateY(-50%); color:#9ca3af;">ðŸ”’</span>
      </div>

      <button id="loginBtn" type="submit" style="
          width:100%;
          padding:15px;
          border:none;
          border-radius:15px;
          background-color:#4f46e5;
          color:white;
          font-size:16px;
          font-weight:600;
          cursor:pointer;
          display:flex;
          justify-content:center;
          align-items:center;
          gap:10px;
          transition: background-color 0.3s;
        ">
        <span id="btnText">Sign In</span>
        <svg id="spinner" style="width:20px; height:20px; display:none; animation: spin 1s linear infinite;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
        </svg>
      </button>

    </form>

    <p id="errorMsg" style="color:#ef4444; font-size:14px; margin-top:20px; text-align:center; display:none;"></p>
  </div>

  <script>
    // Spinner animation
    const style = document.createElement('style');
    style.innerHTML = `@keyframes spin { to { transform: rotate(360deg); } }`;
    document.head.appendChild(style);

    const form = document.getElementById("loginForm");
    const errorMsg = document.getElementById("errorMsg");
    const loginBtn = document.getElementById("loginBtn");
    const btnText = document.getElementById("btnText");
    const spinner = document.getElementById("spinner");

    form.onsubmit = async (e) => {
      e.preventDefault();

      // Show spinner
      btnText.style.display = "none";
      spinner.style.display = "block";
      loginBtn.disabled = true;

      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      try {
        const res = await fetch("/login", {

          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password })
        });

        const data = await res.json();

        if (res.ok) {
          // Save user info in localStorage
          localStorage.setItem("user_id", data.user_id);
          localStorage.setItem("role", data.role);
          localStorage.setItem("username", data.username); // <-- save username

          if (data.role === "admin") {
            window.location.href = "admin_dashboard.html";
          } else {
            window.location.href = "sales.html";
          }
        } else {
          errorMsg.innerText = data.detail || "Invalid login";
          errorMsg.style.display = "block";
        }

      } catch (err) {
        errorMsg.innerText = "Server unreachable. Make sure backend is running.";
        errorMsg.style.display = "block";
      } finally {
        btnText.style.display = "block";
        spinner.style.display = "none";
        loginBtn.disabled = false;
      }
    };
  </script>

</body>
</html>
